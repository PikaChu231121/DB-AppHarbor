# 前后端通信应该怎么做

## 后端准备

- 首先，请确认在`Models`文件夹下有与数据库表名对应的.cs文件。例如，如果你想用`user`这张表，就应该有一个对应的`user.cs`的文件。如果没有，找：贾文超，施帅乾，张宏晔。

  ![391ca2127fa911fb3c204963a19f5ea](C:\Users\uncle\Documents\WeChat Files\wxid_q13i9g15jna612\FileStorage\Temp\391ca2127fa911fb3c204963a19f5ea.png)

- 随后，请考虑好你在通信时需要交换的信息（必须都是表的属性），并将其定义为一个类，格式如下：

  ```
  public class communitationModel(任意有意义的名字)
  {
      public type1 name1 { get; set; } //这里所有变量要与model中定义的变量一致
      public type2 name2 { get; set; }
      ...
  }
  ```

  把这个类写在`Models`文件夹下对应的.cs文件中

  ```c#
  namespace AppHarbor.Server.Models
  {
      [Table("user", Schema = "C##APPHARBOR")]
  
      //开始写的地方
      public class UserLoginModel
      {
          public int Id { get; set; }
          public string Password { get; set; }
      }
      //结束写的地方
      
      //以下内容不能更改
      public class user
      {
          ...
      }
  }
  ```

- 然后，在`Controllers`文件夹中，找到对应的`contoller.cs`文件。在Controller这个类下写一个你所需要的返回函数

```c#
namespace AppHarbor.Server.Controllers
{
    [ApiController]
    [Route("[controller]")]
    public class userController : ControllerBase
    {
        private readonly ApplicationDbContext _dbContext;


        public userController(ApplicationDbContext dbContext)
        {
            this._dbContext = dbContext;

        }

        //仿照以下格式写
        [HttpPost("login")]//[HTTPPost("操作名")]
        public IActionResult Login([FromBody] UserLoginModel loginModel)//这个UserLoginModel改成你刚刚写的的类名
        {
            //以下内容根据需要自己写（需要对表进行什么操作、需要返回给前端什么内容）
            var user = _dbContext.user.Find(loginModel.Id);
            if (user == null)
            {
                return NotFound("user not found");
            }
            if (user.Password == loginModel.Password)
            {
                return Ok(user);
            }
            else
            {
                return BadRequest("Invalid password");
            }
        }

    }
}

```

## 前端准备

前端在发送请求时，应当参考以下格式：

``` .0
axios.post('http://localhost:5118/{表名}/{操作名}', {
    传过去的参数1，传过去的参数2...（与在后端定义的类的结构一致）
})
  .then(response => {
      console.log("successfully logged in");//根据返回内容进行相应操作
  })
  .catch(error => { //根据报错内容进行相应操作
      this.user = null;
      this.error = 'Login failed: ' + error.response.data;
      console.log(this.error);
  });
```

